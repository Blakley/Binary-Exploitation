#include <unistd.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include <ctype.h>

// function definitions
void introduction();
void level_1();
void level_2();
void level_3();
int level_3_cipher();
void level_4();
void level_5();

// determine if we will wait inbetween terminal messages
// 0: waiting disabled, 0: waiting enabled (default binary setting)
int Debugging = 1; 

/* Sleep function */
void waiting(int seconds) {
    if (Debugging == 1) {
     int i = 0;
        while(i < seconds) {
            sleep(1);
            i++;
        }
    }
}

/* Level Failed */
void failed() {
    waiting(2);
    system("clear");
    printf("\n\nIt looks like you failed. Try your luck next time. ψ(｀∇´)ψ  \n");
    exit(0);
}

/* Impssobile Math: Add all the numbers in the text */
void level_5() {
    printf("------------------------------------------------------\n");
    printf("              Level 5 - Impossible Math \n");
    printf("------------------------------------------------------\n\n");
    waiting(1);
    printf("Well done! You've made it to the final level.\n");
    waiting(1);
    printf("Let's see if you're as good as they say.\n");
    waiting(1);
    printf("I'm going to show you a body of text ...\n");
    printf("What is the additive result of all the numbers in the text below? \n\n");
    waiting(2);
    fflush(stdout);

    char text[1505];
    char* dict = "abcdefghijklmnopqrstuvwxyz0123456789";
    int len = strlen(dict);

    int res = 0; 
    for (int i = 0; i < 1499; i++) {
        int choice = rand() % len + 0;
        text[i] = dict[choice];   
        if (isdigit(text[i]))
            res += text[i];
    }

    printf("%s\n\n", text);
    printf("> Result: ");
    
    int value;
    int solved = 0;
    if (scanf("%d", &value) != EOF) {
        if (value == res) {
            printf("> You are a true legend!\n");
            waiting(1);
            printf("> Well DONE!!! \n");
            waiting(1);
            printf("> I didn't know you had it in you. \n");
            printf("> Congrats on completing my game. Next time, I won't go easy on you. \n");
            solved = 1;
        }
    }

    fflush(stdout);

    if (solved == 1) {
        waiting(3);
        exit(0);
    }
    else {
        printf("Your math is bit off there. Better luck next time. \n");
        waiting(1);
        printf("I knew you wouldn't be able to complete all of my challenges. No one can!\n");
        waiting(1);
        failed();
    }
}

/* Lucky guess: Guess the correct letter 10 times in a row */
void level_4() {
    printf("------------------------------------------------------\n");
    printf("              Level 4 - Not So Lucky Guess \n");
    printf("------------------------------------------------------\n\n");
    waiting(1);
    printf("> So far, you've been quite lucky. \n");
    printf("> But your luck ends here! ( ¬ ‿¬) \n");
    printf("> Think you can correctly guess the 10 characters that I'm thinking of? \n");
    waiting(1);
    printf("> A character is defined as either being a number or lowercase letter. Good luck. \n");
    waiting(2);

    printf("> character 1: ");
    fflush(stdout);

    char c1[1];
    char c2[1];
    char c3[1];
    char c4[1];
    char c5[1];
    char c6[1];
    char c7[1];
    char c8[1];
    char c9[1];
    char c10[1];
    int solved = 0;
 
    if (scanf("%s", &c1) != EOF) {
        if (c1[0] == 'b') {       
            printf("> character 2: ");
            
            if (scanf("%s", &c2) != EOF) {
                if (c2[0] == '1') {
                    printf("> character 3: ");    

                    if (scanf("%s", &c3) != EOF) {
                        if (c3[0] == '4') {
                            printf("> character 4: ");    

                                if (scanf("%s", &c4) != EOF) {
                                    if (c4[0] == 'k') {       
                                        printf("> character 5: ");
                                        
                                        if (scanf("%s", &c5) != EOF) {
                                            if (c5[0] == 'l') {
                                                printf("> character 6: ");    

                                                if (scanf("%s", &c6) != EOF) {
                                                    if (c6[0] == '3') {
                                                        printf("> character 7: ");    

                                                            if (scanf("%s", &c7) != EOF) {
                                                                if (c7[0] == 'y') {       
                                                                    printf("> character 8: ");
                                                                    
                                                                    if (scanf("%s", &c8) != EOF) {
                                                                        if (c8[0] == '0') {
                                                                            printf("> character 9: ");    

                                                                            if (scanf("%s", &c9) != EOF) {
                                                                                if (c9[0] == '0') {
                                                                                    printf("> character 10: ");    

                                                                                    if (scanf("%s", &c10) != EOF) {
                                                                                        if (c10[0] == '7') {
                                                                                            solved = 1;
                                                                                            printf("> Wow.. Congrats! You actually solved that challenge. \n");
                                                                                            waiting(1);
                                                                                            printf("> Hate to break it to you but ..\n");
                                                                                            waiting(1);
                                                                                            printf("> The final challenge isn't so easy. \n");
                                                                                            waiting(1);
                                                                                        }
                                                                                    }

                                                                                }     
                                                                            }
                                                                        }     
                                                                    }
                                                                }
                                                            } 

                                                    }     
                                                }
                                            }     
                                        }
                                    }
                                } 
                        }     
                    }
                }     
            }
        }
    } 
    
    fflush(stdout);        

    if (solved == 1) {
        waiting(3);
        level_5();
    }
    else {
        printf("Seems like this level is too hard for you. \n");
        waiting(1);
        failed();
    }
}

/* Level 3 helper: Encode string to a decimal */
int level_3_cipher(char* input) {
    char res[16] = "";
    char* magic = "61313233343536";

    int i = 0;
    int j = 0;
    while (input[i] != '\0') {
        sprintf((char*)(res + j), "%02X", input[i]);
        i += 1;
        j += 2;
    }
    res[j++] = '\0';

    int solved = 1;
    for (int i = 0; i < strlen(magic); i++) {
        if (res[i] != magic[i]) {
            solved = 0;
            break;
        }
    }

    return solved;
}

/* Password Guessing */
void level_3() {
    char password[16];

    printf("------------------------------------------------------\n");
    printf("              Level 3 - Good Password \n");
    printf("------------------------------------------------------\n\n");
    waiting(1);
    printf("> My friend told me that my password is too easy. \n");
    printf("> However, no one has ever cracked it so it can't be that bad. \n");
    waiting(1);
    printf("> Think you have what it takes to crack it? \n");

    printf("What's my password?: ");
    fflush(stdout);

    int solved = 0;
    if (scanf("%s", &password) != EOF) {
        if (level_3_cipher(password) == 1) {
            waiting(1);
            printf("> You cracked my password! \n");
            printf("But wait?? How did you do it.. \n");
            waiting(1);
            printf("Very well, on to the next level you go.\n");
            solved = 1;
        }
        else {
            waiting(1);
            printf("\nThat's not it.\n");
            waiting(1);
            printf("Not even you could crack it? Haha!!\n");
        }
    }

    if (solved == 1) {
        waiting(4);
        level_4();
    }
    else
        failed();
}

/* Number Pattern */
void level_2() {
    printf("\n\n\n------------------------------------------------------\n");
    printf("               Level 2 - Number Pattern \n");
    printf("------------------------------------------------------\n\n");
    waiting(1);
    printf("> Seems like you know a few things. \n");
    printf("> However, I don't think you'll know this one! \n");
    waiting(1);
    printf("> Which trio of numbers are the luckiest? \n");
    
    printf("> number 1: ");
    fflush(stdout);

    int num1 = 0;
    int num2 = 0;
    int num3 = 0;

    int solved = 0;
 
    if (scanf("%d", &num1) != EOF) {
        if (num1 == 7) {       
            waiting(1);
            printf("> The first number is correct\n");
            printf("> number 2: ");
            
            if (scanf("%d", &num2) != EOF) {
                if (num2 == 7) {
                    waiting(1);
                    printf("> The second number is correct\n");
                    printf("> number 3: ");
                    
                    if (scanf("%d", &num3) != EOF) {
                        if (num3 == 7) {
                            waiting(1);
                            printf("Perhaps this is too easy for you? The next one should challenge you! \n");
                            solved = 1;
                        }
                    }
                }    
            }
        }

        fflush(stdout);        
    } 

    if (solved == 1) {
        waiting(4);
        level_3();
    }
    else {
        printf("That's not a part of the awesome trio! \n");
        waiting(1);
        failed();
    }
}

/* Number Guessing */
void level_1() {
    int guess;
    printf("\n------------------------------------------------------\n");
    printf("               Level 1 - Number Guessing \n");
    printf("------------------------------------------------------\n\n");
    waiting(1);
    printf("> There are many important numbers in the universe.\n");
    printf("> Which of those numbers am I?\n");
    waiting(1);
    printf("> guess: ");
    fflush(stdout);
    
    int solved = 0;
    if (scanf("%d", &guess) != EOF) {
        if (guess == 7) {       
            printf("> hmmm.. Not bad. Let's see if you'll get the next one!\n");
            solved = 1;
        }
        else
            printf("I'm sorry but that number isn't that special ...\n");
        
        fflush(stdout);        
    }  

    if (solved == 1) {
        waiting(3);
        level_2();
    }
    else
        failed();
}

/* Introduction message */
void introduction() {
    printf("\n------------------------------------------------------\n");
    printf("                Blakley's Game!\n");
    printf("------------------------------------------------------\n\n");
    waiting(1);
    printf("> Do you have what it takes to complete all of my challenges?\n");
    waiting(1);
    printf("> Let's put your skills to the test. Complete all 5 of my levels.\n");
    waiting(1);
    printf("> Be wary though, one wrong answer and you're done!.\n");
    waiting(1);
    printf("> Good luck and let the games begin!\n");
    waiting(1);
    printf("------------------------------------------------------\n\n");
    
    waiting(3);
    level_1();
}

void main() {
    introduction();
}
